# 感染症動向可視化システム仕様書

## 1. 概要
国立感染症研究所が発表する感染症発生動向調査（IDWR）の速報データを自動的に集計・加工し、一般向けに分かりやすく可視化するWebアプリケーション。

## 2. システム構成
- **バックエンド**: Google Apps Script (GAS) Web App
  - データ取得・保存（IDWRからCSVをダウンロードしGoogleスプレッドシートに保存）
  - データ提供（スプレッドシートを中間DBとして利用し、`doGet`でCSV出力）
- **フロントエンド**: 静的HTML, CSS, JavaScript (GitHub Pages等でのホスティングを想定)
  - CSVデータの取得・パース
  - データの可視化（地図、グラフ、サマリー）

## 3. バックエンド仕様 (GAS Web App)

### 3.1. データ取得・更新ロジック
- **データソース**: 国立感染症研究所 IDWR速報データ (CSV)
  - 以下のデータを取得・保存する。
    1. **定点把握疾患（週報告）**: `...-teiten.csv` (Teitenシート)
    2. **ARI**: `...-ari.csv` (ARIシート)
    3. **定点把握疾患（当該週まで）**: `...-teiten-tougai.csv` (Tougaiシート)
- **実行トリガー**: 毎週木曜日 18:00 に定期実行。

### 3.2. データ加工処理
- 取得したCSVデータをGoogleスプレッドシートの各シート（Teiten, ARI, Tougai）に書き込む。
- スプレッドシートは「リンクを知っている全員が閲覧可」に設定。

### 3.3. データ出力・API提供
- GAS Web Appの `doGet` 関数は、リクエストパラメータ `type` に応じてスプレッドシートのデータをCSV形式（UTF-8）で返す。

## 4. フロントエンド仕様 (HTML/CSS/JS)

### 4.1. デザイン
- 2カラムレイアウト（左：地図/グラフ、右：ランキング/詳細）。
- **サマリーカード**: ホバーエフェクト付きのカードデザイン。選択中の疾患は色分け（インフルエンザ:赤、COVID-19:緑、ARI:橙）で強調表示。

### 4.2. 機能
- **CSV取得・パース**: `Teiten`, `ARI`, `Tougai` の各シートを取得。
- **サマリー表示**: 注目すべき感染症の状況をカード形式で表示。カードクリックで全ビュー（地図、ランキング、詳細パネル）が連動して切り替わる。
- **グラフ表示**: Chart.jsを利用。
  - **右パネル**: 疾患ごとの都道府県別報告数ランキング（Top10）。
  - **県別トレンドグラフ**: 地図上のエリアまたは詳細リストの県名をクリックすると表示される。
    - 流行レベル（注意報・警報）に応じて線の色が変化（緑/オレンジ/赤）。
    - **グラフ表示の維持**: グラフ表示中にサマリーカードで疾患を切り替えた場合、地図に戻らず、選択中の都道府県のグラフを維持して疾患のみを切り替える。同時に、その都道府県が属する地域の詳細パネルも更新して表示する。
  - **地域詳細パネル**:
    - 初期表示時および未選択時は「地図上のエリアをクリックすると詳細が表示されます。」というメッセージを表示する。
- **ヒートマップ表示**: 日本地図SVG。
  - COVID-19: 注意報レベル（10.0）未満は緑。
  - ARI: 80以上で注意（黄）、120以上で流行（赤）。

### 4.3. 基準値（閾値）
- **インフルエンザ**: 注意報 10.0, 警報 30.0
- **COVID-19**: 注意報 10.0, 警報 15.0
- **ARI**: 注意 80.0, 流行 120.0