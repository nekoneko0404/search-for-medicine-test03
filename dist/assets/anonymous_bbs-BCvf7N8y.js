import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */const P="https://anonymous-bbs-worker.neko-neko-0404.workers.dev/api/posts",k=400;let p=[],L=1;document.addEventListener("DOMContentLoaded",()=>{g();const T=document.querySelector(".main-content"),r=document.getElementById("postContent"),a=document.getElementById("submitBtn"),f=document.querySelector(".char-count"),y=document.getElementById("postsContainer"),d=document.getElementById("statusMessage"),S=document.getElementById("pagination");if(g(),new URLSearchParams(window.location.search).get("key")){const e=document.querySelector(".warning-text-footer");e&&e.classList.add("hidden");const o=document.querySelector(".post-form");if(o){const n=document.createElement("div");n.className="admin-mode-banner",n.innerHTML="<span>管理者モード：投稿は「管理者」として公開され、連投制限は適用されません。</span>",o.prepend(n),o.classList.add("admin-active")}a&&(a.classList.add("admin-active"),a.textContent="管理者として送信する")}r.addEventListener("input",()=>{const e=r.value.length;f.textContent=`${e} / ${k}`,e>k?(f.style.color="red",a.disabled=!0):(f.style.color="#6b7280",a.disabled=e===0)}),a.addEventListener("click",async()=>{const e=r.value.trim();if(!e||e.length>k)return;a.disabled=!0,a.textContent="送信中...",d.className="hidden";const o=new URLSearchParams(window.location.search).get("key")?.trim();try{const n=await fetch(P,{method:"POST",headers:{"Content-Type":"application/json","X-Admin-Key":o||""},body:JSON.stringify({content:e,adminKey:o})}),t=await n.json();if(!n.ok)throw n.status===429?new Error(t.error||"連投できません。まったりいきましょう。（3時間規制）"):new Error(t.error||"送信に失敗しました。");J(t.id,t.deleteKey),r.value="",f.textContent=`0 / ${k}`,h("送信しました！","success"),g()}catch(n){h(n.message,"error")}finally{a.disabled=!1,a.textContent="送信する"}});function h(e,o){d.textContent=e,d.className=o,d.style.display="block",setTimeout(()=>{d.style.display="none"},5e3)}async function g(){try{const e=await fetch(P);if(!e.ok)throw new Error("読み込みに失敗しました");p=await e.json(),_()}catch(e){y.innerHTML=`<p class="error">読み込みエラー: ${e.message}</p>`}}function _(){if(y.innerHTML="",p.length===0){y.innerHTML='<p class="loading">投稿はまだありません。</p>',S.innerHTML="";return}let e,o;L===1?(e=0,o=10,T.classList.remove("is-p2-plus")):(e=10+(L-2)*20,o=e+20,T.classList.add("is-p2-plus")),p.slice(e,o).forEach(t=>{const c=document.createElement("div");c.className="post",t.is_admin&&c.classList.add("is-admin"),c.dataset.postNumber=t.post_number;const m=new Date(t.created_at).toLocaleString("ja-JP"),u=new URLSearchParams(window.location.search).get("key"),N=M(t.id)||u,w=document.createElement("div");w.className="post-meta";const l=document.createElement("div");if(l.className="left-meta",t.post_number){const s=document.createElement("span");s.className="post-number",s.textContent=`${t.post_number}`,l.appendChild(s)}if(t.is_admin){const s=document.createElement("span");s.className="admin-badge",s.textContent="管理者",l.appendChild(s)}const B=document.createElement("span");B.textContent=m,l.appendChild(B);const v=document.createElement("button");if(v.className="reply-btn",v.textContent="返信",v.addEventListener("click",()=>{const s=`>>${t.post_number}
`;r.value=s+r.value,r.focus(),window.scrollTo({top:document.querySelector(".post-form").offsetTop-20,behavior:"smooth"})}),l.appendChild(v),w.appendChild(l),N){const s=document.createElement("button");s.className="delete-btn",s.textContent="削除",s.addEventListener("click",()=>H(t.id,u)),w.appendChild(s)}const C=document.createElement("div");C.className="post-content",t.content.split(/(>>\d+)/g).forEach(s=>{if(s.match(/^>>\d+$/)){const D=s.substring(2),i=document.createElement("a");i.href="#",i.className="reply-link",i.textContent=s,i.addEventListener("click",x=>{x.preventDefault();const E=document.querySelector(`.post[data-post-number="${D}"]`);E&&(E.scrollIntoView({behavior:"smooth",block:"center"}),E.style.backgroundColor="#fef08a",setTimeout(()=>{E.style.backgroundColor=""},2e3))}),i.addEventListener("mouseenter",x=>I(x,D)),i.addEventListener("mouseleave",$),C.appendChild(i)}else C.appendChild(document.createTextNode(s))}),c.appendChild(w),c.appendChild(C),y.appendChild(c)}),K()}let b=null;function I(e,o){const n=p.find(N=>N.post_number==o);if(!n)return;$();const t=document.createElement("div");t.className="hover-preview";const c=document.createElement("div");c.className="post-meta",c.textContent=`No.${n.post_number} (${new Date(n.created_at).toLocaleString("ja-JP")})`;const m=document.createElement("div");m.className="post-content",m.textContent=n.content,t.appendChild(c),t.appendChild(m),document.body.appendChild(t),b=t;const u=e.target.getBoundingClientRect();t.style.left=`${u.left+window.scrollX}px`,t.style.top=`${u.top+window.scrollY-t.offsetHeight-10}px`}function $(){b&&(b.remove(),b=null)}function K(){S.innerHTML="";const e=Math.min(p.length,100);let o=1;if(e>10&&(o=1+Math.ceil((e-10)/20)),!(o<=1))for(let n=1;n<=o;n++){const t=document.createElement("button");t.className=`page-btn ${n===L?"active":""}`,t.textContent=n,t.addEventListener("click",()=>{L=n,_(),window.scrollTo({top:0,behavior:"smooth"})}),S.appendChild(t)}}async function H(e,o){if(!confirm("この投稿を削除しますか？"))return;const n=o||M(e);if(n)try{if(!(await fetch(`${P}?id=${e}`,{method:"DELETE",headers:{"X-Delete-Key":n}})).ok)throw new Error("削除できませんでした");O(e),g(),h("削除しました","success")}catch(t){h(t.message,"error")}}function J(e,o){let n=JSON.parse(localStorage.getItem("bbs_keys")||"{}");n[e]=o,localStorage.setItem("bbs_keys",JSON.stringify(n))}function M(e){return JSON.parse(localStorage.getItem("bbs_keys")||"{}")[e]}function O(e){let o=JSON.parse(localStorage.getItem("bbs_keys")||"{}");delete o[e],localStorage.setItem("bbs_keys",JSON.stringify(o))}});
