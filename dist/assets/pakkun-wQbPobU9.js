import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */const R="medicine_reward_app_v2",f={currentTab:0,tabs:[{config:null,progress:{stamps:0,timestamps:[],lastStampTime:null}},{config:null,progress:{stamps:0,timestamps:[],lastStampTime:null}},{config:null,progress:{stamps:0,timestamps:[],lastStampTime:null}}]},k={settings:document.getElementById("settings-view"),main:document.getElementById("main-view")},K={settings:document.getElementById("settings-form")},i={dosesInput:document.getElementById("doses-per-day"),durationInput:document.getElementById("duration-days"),testModeInput:document.getElementById("test-mode"),grid:document.getElementById("stamp-grid"),remainingCount:document.getElementById("remaining-count"),resetBtn:document.getElementById("reset-btn"),surpriseOverlay:document.getElementById("surprise-overlay"),surpriseElement:document.getElementById("surprise-element"),characterArea:document.getElementById("character-area"),statusMessage:document.getElementById("status-message"),tabBtns:document.querySelectorAll(".tab-btn"),manualModal:document.getElementById("manual-modal"),openManualBtn:document.getElementById("open-manual-btn"),closeManualBtn:document.getElementById("close-manual-btn")};async function W(){z(),J(),j(),h()}function j(){i.openManualBtn.addEventListener("click",()=>{i.manualModal.classList.remove("hidden")}),i.closeManualBtn.addEventListener("click",()=>{i.manualModal.classList.add("hidden")}),i.manualModal.addEventListener("click",t=>{t.target===i.manualModal&&i.manualModal.classList.add("hidden")})}function z(){const t=localStorage.getItem(R);if(t){const e=JSON.parse(t);e.tabs?(f.currentTab=e.currentTab||0,f.tabs=e.tabs):(f.tabs[0].config=e.config,f.tabs[0].progress=e.progress)}}function g(){localStorage.setItem(R,JSON.stringify(f))}function m(){return f.tabs[f.currentTab]}function J(){i.tabBtns.forEach(t=>{t.addEventListener("click",()=>{const e=parseInt(t.dataset.tab);Y(e)})})}function Y(t){f.currentTab=t,l=0,g(),h()}function h(){i.tabBtns.forEach(e=>{e.classList.toggle("active",parseInt(e.dataset.tab)===f.currentTab)}),m().config?(N("main"),B(),tt(),et(),X()):(N("settings"),i.dosesInput.value=3,i.durationInput.value=7,i.testModeInput.checked=!1,i.medicineInputs.forEach(e=>e.value=""),i.medicineInfoPreview.classList.add("hidden"),selectedMedicinesBuffer=[null,null,null,null,null,null])}function N(t){Object.values(k).forEach(e=>e.classList.add("hidden")),k[t].classList.remove("hidden")}K.settings.addEventListener("submit",t=>{t.preventDefault();const e=parseInt(i.dosesInput.value),n=parseInt(i.durationInput.value),o=i.testModeInput.checked,a=m();a.config={dosesPerDay:e,durationDays:n,totalSlots:e*n,testMode:o,startOffset:0},a.progress={stamps:0,timestamps:[],lastStampTime:null},l=0,g(),h()});function A(t){return t===1?12:t===2?6:t===3?4:1}function U(t){const e=m(),n=e.progress.timestamps||[],a=A(e.config.dosesPerDay)*60*60*1e3;if(t===0)return 0;let s=1/0,r=!1;for(let u=0;u<n.length;u++){const p=n[u];if(p==="SKIPPED")continue;const d=new Date(p).getTime()+(t-u)*a;d<s&&(s=d),r=!0}if(!r)return 0;const y=e.config.dosesPerDay;if(t>0&&t%y===0){const u=t-1;if(u<n.length){const p=n[u];if(p!=="SKIPPED"){const b=new Date(p);let d=new Date(b);b.getHours()<6||d.setDate(d.getDate()+1),d.setHours(6,0,0,0),d.getTime()>s&&(s=d.getTime())}}}return s}function M(){const t=m();if(t.config.testMode||!t.progress.lastStampTime)return!0;const e=new Date(t.progress.lastStampTime).getTime(),n=new Date().getTime(),o=A(t.config.dosesPerDay);return n-e>=o*60*60*1e3}let x=null;function Q(){x&&clearTimeout(x);const t=m();if(!t.progress.lastStampTime)return;const e=new Date(t.progress.lastStampTime).getTime(),n=A(t.config.dosesPerDay),o=e+n*60*60*1e3,a=new Date().getTime(),s=o-a;s>0&&s<2147483647&&(x=setTimeout(()=>{h(),q()},s+1e3))}function X(){const t=m(),e=i.statusMessage;if(t.progress.stamps>=t.config.totalSlots){e.textContent="コンプリートおめでとう！",e.className="status-ok";return}if(!M()){e.textContent="まだお薬の時間じゃないよ",e.className="status-wait";return}e.textContent="お薬飲めたかな？",e.className="status-ok"}let l=0;function Z(){const t=m(),e=t.config.durationDays,n=t.config.dosesPerDay,o=t.progress.stamps;let a=Math.floor(o/n);a>=e&&(a=e-1),l=Math.floor(a/7)}function B(){typeof l>"u"&&(l=0),i.grid.innerHTML="";const t=m();if(!t.config)return;const e=t.config.durationDays,n=Math.ceil(e/7),o=document.createElement("div");o.className="pagination-controls";const a=document.createElement("button");a.className="btn-nav",a.textContent="← 前の週",a.disabled=l===0,a.onclick=()=>{l--,B()};const s=document.createElement("button");s.className="btn-nav",s.textContent="次の週 →",s.disabled=l>=n-1,s.onclick=()=>{l++,B()},o.appendChild(a),o.appendChild(s),i.grid.appendChild(o);const r=t.config.dosesPerDay;t.progress.stamps;const y=t.progress.timestamps||[],u=t.config.startOffset||0,p=l*7+1,b=Math.min(p+6,e);let d=(p-1)*r;for(let D=p;D<=b;D++){const w=document.createElement("div");w.className="day-card";const C=document.createElement("div");C.className="day-label",C.textContent=`${D} 日目`,w.appendChild(C);const S=document.createElement("div");S.className="day-slots";for(let L=0;L<r;L++){const v=d;if(v>=t.config.totalSlots)break;const c=document.createElement("div");if(c.className="stamp-slot",v<u)c.style.visibility="hidden";else{const T=v-u;if(T<0)c.style.visibility="hidden";else if(T<y.length)if(y[T]==="SKIPPED")c.classList.add("skipped"),c.textContent="Skip",c.addEventListener("click",()=>O(v));else{c.classList.add("stamped");const I=document.createElement("div");I.className="stamp-mark",c.appendChild(I)}else{if(T===y.length)M()?c.classList.add("next-slot"):(c.classList.add("wait-slot"),Q());else if(T>y.length)if(M()){const P=U(T);new Date().getTime()>=P?(c.classList.add("skip-slot"),c.style.borderColor="var(--primary-color)"):c.classList.add("wait-slot")}else c.classList.add("wait-slot");c.addEventListener("click",()=>O(v))}}S.appendChild(c),d++}S.children.length>0&&(w.appendChild(S),i.grid.appendChild(w))}}function tt(){const t=m();if(!t.config)return;const e=t.config.startOffset||0,n=t.config.totalSlots-e-t.progress.stamps;i.remainingCount.textContent=n}function et(){const t=document.createElement("img");t.src="images/doctor_bear.png",t.className="character-img",i.characterArea.innerHTML="",i.characterArea.appendChild(t)}function O(t){const e=m(),n=e.progress.stamps,o=e.config.startOffset||0;if(n===0&&o===0){const s=e.config.dosesPerDay;if(t<s)if(t>0)if(confirm(`${t+1} 回目からスタートしますか？
前の${t} 回分はスキップされ、期間が延長されます。`)){e.config.startOffset=t,e.config.totalSlots+=t,e.config.durationDays=Math.ceil(e.config.totalSlots/s),g(),E();return}else return;else{E();return}}const a=o+n;if(t<a){const s=t-o;s>=0&&e.progress.timestamps[s]==="SKIPPED"&&confirm("このスキップを取り消して、現在時刻でスタンプしますか？")&&(e.progress.timestamps[s]=new Date().toISOString(),g(),h());return}if(!M()){it(),alert("まだ早いよ！次のお薬の時間まで待ってね。");return}if(t>a){const s=t-a;if(confirm(`間の ${s} 回分をスキップして、ここを記録しますか？`)){for(let r=0;r<s;r++)e.progress.stamps++,e.progress.timestamps.push("SKIPPED");E()}return}E()}function E(){const t=m();t.progress.stamps++,t.progress.timestamps.push(new Date().toISOString()),t.progress.lastStampTime=new Date().toISOString(),g(),nt();const e=t.config.dosesPerDay,n=t.config.startOffset||0,o=n+t.progress.stamps-1,a=Math.floor(o/e);if(Math.floor(a/7)!==l){const r=l*7+6;a>r&&l++}h(),t.progress.stamps+n>=t.config.totalSlots&&setTimeout(rt,1e3)}i.resetBtn.addEventListener("click",()=>{if(confirm("本当にリセットしますか？これまでの記録は消えてしまいます。")){const t=m();t.config=null,t.progress={stamps:0,timestamps:[],lastStampTime:null},l=0,g(),h()}});const V=[_,$,G,H,H],F=["ハイタッチして『ゴックン、かっこよかったよ！』","ぎゅーっと抱きしめて『最後までがんばったね！』","目をしっかり見て『お口を大きく開けられたね！』","頭をなでながら『苦いのに挑戦してえらかったね』","一緒に万歳して『お薬パワー、注入完了だね！』","笑顔で『自分から準備してくれて、パパ/ママ助かっちゃった』","鼻をちょんと触って『勇気の音が聞こえたよ！』","肩をトントンして『座って飲めて、お兄さん/お姉さんみたい』","『すごい！』と驚いた顔をして、お子様と目を合わせる","手を握って『一緒にがんばれて嬉しいな』","『バイバイキン！』と言いながら、空に向かって手を振る","お子様のほっぺに優しく触れて『ピカピカのお口だね』","親指を立てて（Good!）『今の飲み方、100点満点！』","『お薬さんとお友達になれたね』と優しくささやく","カレンダーを一緒に指さして『また一歩、元気に近づいたね』","『お薬パワーで体が喜んでるよ』とお腹を優しくさする","『魔法のゴックンだね！』と拍手する","お子様の目線に合わせてしゃがみ『勇気を見せてくれてありがとう』","『バイキンマンが逃げていったよ！』と窓の外を指さす","『お薬のチャンピオンだ！』と王冠を乗せるジェスチャーをする","『喉を通る音が聞こえたよ、上手！』と喉を優しく指さす","『パパ/ママも元気が出てきた！』とお子様に抱きつく","『お薬の時間を覚えててくれて、びっくりしたよ』と褒める","『お水も上手に使えたね』とコップを持つ手を褒める","『お薬の妖精さんが拍手してるよ』と耳をすます真似をする","『今のゴックン、もう一回見たいくらい上手だった！』","『お顔がキラキラしてきたね』と鏡を一緒に見る","『強い心が見えたよ』と胸に手を当てる","『お薬の階段、また一つ登ったね』と指で階段を作る","『明日は何して遊ぼうか？』と未来の楽しい話を添える","『お薬を飲む姿、動画に撮っておきたいくらいだよ』","『お口の準備が早くて助かるな』と準備の早さを褒める","『苦いのも、勇気でペロリだったね』","『お薬のスペシャリストだね！』と敬礼する","『体がどんどん強くなってるよ』と力こぶのポーズをする","『お薬の冒険、今日の分はクリアだね！』","『ニコニコで飲んでくれて、ママ/パパもニコニコになっちゃう』","『お薬の神様が、がんばりカードを見てるよ』","『自分でお薬を持てたね、すごい！』と手の動きを褒める","『お薬の匂いも平気なんだね、かっこいい！』","『お薬の魔法使いみたいだね』とステッキを振る真似をする","『がんばった証のスタンプ、自分で押してみる？』","『お薬の味がしても、最後まで飲めたね』と粘り強さを褒める","『お口の中が綺麗になったね』とライトで照らす真似をして遊ぶ","『お薬の達人だ！』と大げさに驚いて見せる","『お薬の山、ひょいっと越えちゃったね』","『勇気のしずく、全部届いたよ』","『お薬のゴールまであと少し、一緒に走ろう！』","『世界一のがんばり屋さんだね』とほっぺにチューする","『お薬飲めたね！』と全力で喜びを表現する"];function nt(){q(),i.characterArea.innerHTML='<img src="images/nurse_rabbit.png" class="character-img" />';const t=F[Math.floor(Math.random()*F.length)];if(st(t),Math.random()<.1)at();else{const e=V[Math.floor(Math.random()*V.length)];e()}}function st(t){const e=document.createElement("div");e.className="praise-bubble",e.textContent=t,document.body.appendChild(e),requestAnimationFrame(()=>{e.classList.add("show")}),setTimeout(()=>{e.classList.remove("show"),setTimeout(()=>e.remove(),500)},6e3)}function at(){for(let e=0;e<20;e++){const n=document.createElement("div");n.className="rare-stamp-effect",n.textContent="👑",n.style.left=Math.random()*100+"vw",n.style.top="-50px",n.style.animationDuration=2+Math.random()*2+"s",n.style.animationDelay=Math.random()+"s",document.body.appendChild(n),setTimeout(()=>n.remove(),4e3)}ot()}function H(){const t=["💮","💯","👍","👑","🌈","💊","✨","🐰","🐻"],e=t[Math.floor(Math.random()*t.length)],n=document.createElement("div");n.textContent=e,n.className="big-stamp-effect",document.body.appendChild(n),setTimeout(()=>n.remove(),3e3)}function q(){const t=new(window.AudioContext||window.webkitAudioContext),e=t.createOscillator(),n=t.createGain();e.type="sine";const o=523.25+Math.random()*523.25;e.frequency.setValueAtTime(o,t.currentTime),e.frequency.exponentialRampToValueAtTime(o*2,t.currentTime+.1),n.gain.setValueAtTime(.1,t.currentTime),n.gain.exponentialRampToValueAtTime(.01,t.currentTime+.5),e.connect(n),n.connect(t.destination),e.start(),e.stop(t.currentTime+.5)}function ot(){const t=new(window.AudioContext||window.webkitAudioContext);[523.25,659.25,783.99,1046.5,1318.51,1567.98].forEach((e,n)=>{const o=t.createOscillator(),a=t.createGain();o.frequency.value=e,o.type="triangle";const s=t.currentTime+n*.1;a.gain.setValueAtTime(0,s),a.gain.linearRampToValueAtTime(.1,s+.05),a.gain.exponentialRampToValueAtTime(.001,s+.4),o.connect(a),a.connect(t.destination),o.start(s),o.stop(s+.4)})}function it(){const t=new(window.AudioContext||window.webkitAudioContext),e=t.createOscillator(),n=t.createGain();e.type="sawtooth",e.frequency.setValueAtTime(200,t.currentTime),e.frequency.linearRampToValueAtTime(100,t.currentTime+.2),n.gain.setValueAtTime(.1,t.currentTime),n.gain.exponentialRampToValueAtTime(.01,t.currentTime+.2),e.connect(n),n.connect(t.destination),e.start(),e.stop(t.currentTime+.2)}function _(){const t=["💊","💖","⭐","🔷","🌸","✨","🍬","🎈","🧸","💊"],e=["■","▲","●","★","♦","❤"],n=["#FF9AA2","#FFB7B2","#FFDAC1","#E2F0CB","#B5EAD7","#C7CEEA","#FFD700","#FF69B4"],o=document.body;for(let a=0;a<30;a++){const s=document.createElement("div");Math.random()>.6?(s.className="confetti confetti-icon",s.textContent=t[Math.floor(Math.random()*t.length)],s.style.fontSize=1.5+Math.random()+"rem"):(s.className="confetti confetti-shape",s.textContent=e[Math.floor(Math.random()*e.length)],s.style.color=n[Math.floor(Math.random()*n.length)],s.style.fontSize=.8+Math.random()*.8+"rem"),s.style.left=Math.random()*100+"vw",s.style.top="-50px",s.style.animationDuration=3+Math.random()*3+"s",s.style.animationDelay=Math.random()+"s",o.appendChild(s),setTimeout(()=>s.remove(),6e3)}}function $(){const t=["🧸","💊","✨","👍","🐻","🐰","💖","🎉"],e=document.getElementById("app")||document.body;for(let n=0;n<20;n++){const o=document.createElement("div");o.className="floating-emoji",o.textContent=t[Math.floor(Math.random()*t.length)],o.style.left=10+Math.random()*80+"%",o.style.top=50+Math.random()*30+"%";const a=4+Math.random()*3;o.style.animationDuration=`${a}s`,o.style.animationDelay=Math.random()*.5+"s",e.appendChild(o),setTimeout(()=>o.remove(),a*1e3+500)}}function G(){const t=document.getElementById("app")||document.body;t.classList.add("gradient-flash-effect"),setTimeout(()=>t.classList.remove("gradient-flash-effect"),3e3)}function rt(){ct();const t=document.getElementById("surprise-overlay"),e=document.getElementById("surprise-element");window.resetCurrentTabApp=()=>{const a=m();a.config=null,a.progress={stamps:0,timestamps:[],lastStampTime:null},l=0,g(),location.reload()};const n=new Date,o=`${n.getFullYear()}年 ${n.getMonth()+1}月 ${n.getDate()}日`;e.innerHTML=`
        <div class="completion-modal certificate-modal">
            <div class="certificate-border">
                <div class="certificate-header">
                    <span class="certificate-icon">🏆</span>
                    <h2>がんばったで賞</h2>
                    <span class="certificate-icon">🏆</span>
                </div>
                
                <div class="certificate-body">
                    <p class="certificate-text">
                        あなたは、おくすりを<br>
                        さいごまでしっかりのんで<br>
                        びょうきとたたかいました。
                    </p>
                    <p class="certificate-text">
                        そのゆうきと<br>
                        がんばりをたたえます。
                    </p>
                    
                    <div class="certificate-name-area">
                        <label>お名前:</label>
                        <input type="text" class="certificate-name-input" placeholder="ここになまえをかいてね" />
                    </div>
                    
                    <div class="certificate-date">
                        ${o}
                    </div>
                    
                    <div class="certificate-characters">
                        <div class="character-signature">
                            <img src="images/doctor_bear.png" alt="くま先生">
                            <span>くま先生</span>
                        </div>
                        <div class="character-signature">
                            <img src="images/nurse_rabbit.png" alt="うさぎ看護師">
                            <span>うさぎ看護師</span>
                        </div>
                        <div class="character-signature">
                            <img src="images/pharmacist_cat.png" alt="ねこ薬剤師">
                            <span>ねこ薬剤師</span>
                        </div>
                    </div>
                </div>

                <div class="no-print">
                    <button onclick="window.print()" class="btn-secondary" style="margin-right: 10px;">🖨️ 賞状を印刷する</button>
                    <button onclick="resetCurrentTabApp()" class="btn-primary">もういっかい！</button>
                </div>
            </div>
        </div>
    `,G(),$();for(let a=0;a<8;a++)setTimeout(_,a*300);setTimeout(()=>{t.classList.remove("hidden"),t.classList.add("active"),t.classList.add("show")},3500)}function ct(){const t=new(window.AudioContext||window.webkitAudioContext),e=t.currentTime;[261.63,329.63,392,523.25].forEach((n,o)=>{const a=t.createOscillator(),s=t.createGain();a.frequency.value=n,a.connect(s),s.connect(t.destination);const r=e+o*.1;s.gain.setValueAtTime(.1,r),s.gain.exponentialRampToValueAtTime(.01,r+.5),a.start(r),a.stop(r+.5)})}window.addEventListener("load",()=>{const t=m();t&&t.config&&t.progress.stamps>0&&Z()});W();
