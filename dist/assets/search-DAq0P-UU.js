import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{n as U,d as Y}from"./utils-cz7vvGbo.js";import{l as G}from"./data-BguHeUhv.js";import{s as m,u as O,c as q,r as J,h as A}from"./ui-C1FH7vrA.js";import"./MainHeader-Cz0INnUv.js";let y=[],h=[],N={status:"asc",productName:"asc",ingredientName:"asc"};document.getElementById("messageBox");document.getElementById("tableContainer");document.getElementById("cardContainer");const z=document.getElementById("resultsWrapper");let P=!1;function W(n){const s=n.split(/\s+|　+/).filter(l=>l!==""),o=[],d=[];return s.forEach(l=>{(l.startsWith("ー")||l.startsWith("-"))&&l.length>1?d.push(U(l.substring(1))):o.push(U(l))}),{include:o,exclude:d}}function b(){if(document.getElementById("infoContainer").classList.add("hidden"),y.length===0)return;const n=W(document.getElementById("drugName").value),s=W(document.getElementById("ingredientName").value),o=W(document.getElementById("makerName").value),d=document.getElementById("statusNormal").checked&&document.getElementById("statusLimited").checked&&document.getElementById("statusStopped").checked;if(n.include.length===0&&n.exclude.length===0&&s.include.length===0&&s.exclude.length===0&&o.include.length===0&&o.exclude.length===0&&d){V([]),z.classList.add("hidden"),document.body.classList.remove("search-mode"),document.getElementById("infoContainer").classList.remove("hidden");return}else z.classList.remove("hidden"),document.getElementById("infoContainer").classList.add("hidden");const a=[];document.getElementById("statusNormal").checked&&a.push("通常出荷"),document.getElementById("statusLimited").checked&&a.push("限定出荷"),document.getElementById("statusStopped").checked&&a.push("供給停止"),h=y.filter(f=>{if(!f)return!1;const C=f.normalizedProductName||"",g=f.normalizedIngredientName||"",I=f.normalizedMakerName||"",L=n.include.every(c=>C.includes(c))&&(n.exclude.length===0||!n.exclude.some(c=>C.includes(c))),w=s.include.every(c=>g.includes(c))&&(s.exclude.length===0||!s.exclude.some(c=>g.includes(c))),x=o.include.every(c=>C.includes(c)||I.includes(c)||g.includes(c))&&(o.exclude.length===0||!o.exclude.some(c=>C.includes(c)||I.includes(c)||g.includes(c)));if(a.length===0)return!1;const r=(f.shipmentStatus||"").trim();let p=!1;return a.includes("通常出荷")&&(r.includes("通常出荷")||r.includes("通"))&&(p=!0),a.includes("限定出荷")&&(r.includes("限定出荷")||r.includes("出荷制限")||r.includes("限")||r.includes("制"))&&(p=!0),a.includes("供給停止")&&(r.includes("供給停止")||r.includes("停止")||r.includes("停"))&&(p=!0),L&&w&&x&&p}),V(h),document.body.classList.toggle("search-mode",h.length>0),h.length===0?(m("検索結果が見つかりませんでした。","info"),A(2e3)):h.length>500?(m(`${h.length} 件のデータが見つかりました。
表示は上位 500 件に制限されています。`,"success"),A(2e3)):(m(`${h.length} 件のデータが見つかりました。`,"success"),A(2e3)),N.status="asc",N.productName="asc";const e=document.getElementById("sort-status-icon");e&&(e.textContent="↕");const u=document.getElementById("sort-productName-icon");u&&(u.textContent="↕");const i=document.getElementById("sort-ingredientName-icon");i&&(i.textContent="↕")}function V(n){console.log("renderTable called with data length:",n.length);const s=document.getElementById("searchResultTableBody"),o=document.getElementById("cardContainer"),d=document.getElementById("tableContainer");if(!s||!o||!d){console.error("Missing DOM elements in renderTable:",{resultBody:s,cardContainer:o,tableContainer:d});return}if(s.innerHTML="",o.innerHTML="",n.length===0){const u=s.insertRow().insertCell(0);u.colSpan=5,u.textContent="該当データがありません",u.className="px-4 py-3 text-sm text-gray-500 text-center italic";const i=document.createElement("div");i.className="bg-white p-8 text-center text-gray-500 italic rounded-lg shadow",i.textContent="該当データがありません",o.appendChild(i);return}const l=n.slice(0,500),a={productName:5,ingredientName:2,shipmentStatus:11,reasonForLimitation:13,shipmentVolumeStatus:16};l.forEach((e,u)=>{const i=s.insertRow(),f=u%2===1?"bg-indigo-50":"bg-white";i.className=`${f} transition-colors duration-150 hover:bg-indigo-200`;const C=i.insertCell(0);C.setAttribute("data-label","品名"),C.classList.add("px-4","py-2","text-sm","text-gray-900","relative","align-top"),e.updatedCells&&e.updatedCells.includes(a.productName)&&C.classList.add("text-red-600","font-bold");const g=document.createElement("div");g.className="vertical-labels-container";const I=e.productCategory&&U(e.productCategory).includes("後発品"),L=e.isBasicDrug&&U(e.isBasicDrug).includes("基礎的医薬品");if(I){const t=document.createElement("span");t.className="medicine-badge badge-generic",t.textContent="後",g.appendChild(t)}if(L){const t=document.createElement("span");t.className="medicine-badge badge-basic",t.textContent="基",g.appendChild(t)}const w=e.productName||"",x=document.createElement("div");if(x.className="flex items-start",g.hasChildNodes()&&x.appendChild(g),e.yjCode){const t=q(e,u);x.appendChild(t)}else{const t=document.createElement("span");t.className="font-semibold truncate-lines",t.textContent=w,x.appendChild(t)}C.appendChild(x);const r=i.insertCell(1);r.setAttribute("data-label","成分名"),r.classList.add("px-4","py-2","text-sm","text-gray-900","truncate-lines","align-top"),e.updatedCells&&e.updatedCells.includes(a.ingredientName)&&r.classList.add("text-red-600","font-bold");const p=e.ingredientName||"";if(p){const t=document.createElement("a");t.href="#",t.className="text-indigo-600 font-semibold hover:underline",t.textContent=p,t.addEventListener("click",M=>{M.preventDefault(),Q(p)}),r.appendChild(t)}else r.textContent=p;const c=i.insertCell(2);c.setAttribute("data-label","出荷状況"),c.classList.add("tight-cell","py-2","text-gray-900","text-left","align-top");const S=document.createElement("div");S.className="flex items-center";const K=e.updatedCells&&e.updatedCells.includes(a.shipmentStatus);K&&c.classList.add("text-red-600","font-bold");const H=(e.shipmentStatus||"").trim();if(S.appendChild(J(H,K)),e.shippingStatusTrend){const t=document.createElement("span");t.className="ml-1 text-red-500",t.textContent=e.shippingStatusTrend,S.appendChild(t)}c.appendChild(S);const k=i.insertCell(3);k.textContent=e.reasonForLimitation||"",k.setAttribute("data-label","制限理由"),k.classList.add("px-4","py-2","text-xs","text-gray-900","truncate-lines","align-top"),e.updatedCells&&e.updatedCells.includes(a.reasonForLimitation)&&k.classList.add("text-red-600","font-bold");const D=i.insertCell(4);D.textContent=e.shipmentVolumeStatus||"",D.setAttribute("data-label","出荷量状況"),D.classList.add("px-4","py-2","text-xs","text-gray-900","align-top"),e.updatedCells&&e.updatedCells.includes(a.shipmentVolumeStatus)&&D.classList.add("text-red-600","font-bold");const E=document.createElement("div");E.className="bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex flex-col gap-3";const $=document.createElement("div");$.className="flex items-start gap-2";const v=document.createElement("div");if(v.className="flex flex-col gap-1 mt-1",I){const t=document.createElement("span");t.className="bg-green-200 text-green-800 px-1 rounded-sm text-[10px] font-bold whitespace-nowrap text-center",t.textContent="後",v.appendChild(t)}if(L){const t=document.createElement("span");t.className="bg-purple-200 text-purple-800 px-1 rounded-sm text-[10px] font-bold whitespace-nowrap text-center",t.textContent="基",v.appendChild(t)}v.hasChildNodes()&&$.appendChild(v);const F=document.createElement("div");if(F.className="flex-grow min-w-0",e.yjCode){const t=q(e,u+1e4);F.appendChild(t)}else{const t=document.createElement("span");t.className="font-bold text-gray-900 break-words",e.updatedCells&&e.updatedCells.includes(a.productName)&&t.classList.add("text-red-600"),t.textContent=w,F.appendChild(t)}if($.appendChild(F),E.appendChild($),p){const t=document.createElement("div");t.className="text-xs text-gray-600";const M=document.createElement("span");M.textContent="成分: ",t.appendChild(M);const B=document.createElement("a");B.href="#",B.className="text-indigo-600 hover:underline",B.textContent=p,B.addEventListener("click",X=>{X.preventDefault(),Q(p)}),t.appendChild(B),E.appendChild(t)}const R=document.createElement("div");R.className="flex items-center justify-between";const T=document.createElement("div");if(T.className="flex items-center",T.appendChild(J(H,K)),e.shippingStatusTrend){const t=document.createElement("span");t.className="ml-1 text-red-500",t.textContent=e.shippingStatusTrend,T.appendChild(t)}if(R.appendChild(T),e.shipmentVolumeStatus){const t=document.createElement("div");t.className="text-xs text-gray-500",t.textContent=e.shipmentVolumeStatus,e.updatedCells&&e.updatedCells.includes(a.shipmentVolumeStatus)&&t.classList.add("text-red-600","font-bold"),R.appendChild(t)}if(E.appendChild(R),e.reasonForLimitation){const t=document.createElement("div");t.className="text-xs text-gray-700 bg-gray-50 p-2 rounded",e.updatedCells&&e.updatedCells.includes(a.reasonForLimitation)&&t.classList.add("text-red-600","font-bold"),t.textContent=e.reasonForLimitation,E.appendChild(t)}o.appendChild(E)})}function Z(){const n=new URLSearchParams(window.location.search),s=n.get("drug"),o=n.get("ingredient"),d=n.get("maker");if(!s&&!o&&!d&&!n.has("normal"))return!1;s&&(document.getElementById("drugName").value=s),o&&(document.getElementById("ingredientName").value=o),d&&(document.getElementById("makerName").value=d);const l=n.get("normal"),a=n.get("limited"),e=n.get("stopped");return l!==null&&(document.getElementById("statusNormal").checked=l==="1"),a!==null&&(document.getElementById("statusLimited").checked=a==="1"),e!==null&&(document.getElementById("statusStopped").checked=e==="1"),!0}async function _(){const n=document.getElementById("drugName").value.trim(),s=document.getElementById("ingredientName").value.trim(),o=document.getElementById("makerName").value.trim(),d=document.getElementById("statusNormal").checked,l=document.getElementById("statusLimited").checked,a=document.getElementById("statusStopped").checked,e=new URLSearchParams;n&&e.set("drug",n),s&&e.set("ingredient",s),o&&e.set("maker",o),e.set("normal",d?"1":"0"),e.set("limited",l?"1":"0"),e.set("stopped",a?"1":"0");const i=`${window.location.origin+window.location.pathname}?${e.toString()}`;try{await navigator.clipboard.writeText(i),m("検索条件のURLをクリップボードにコピーしました","success")}catch(f){console.error("Failed to copy to clipboard:",f),m("URLのコピーに失敗しました","error")}}function j(n){if(h.length===0){m("ソートするデータがありません。","info");return}const s=N[n]==="asc"?"desc":"asc";N[n]=s;for(const d in N)if(d!==n){N[d]="asc";const l=document.getElementById(`sort-${d}-icon`);l&&(l.textContent="↕")}document.getElementById(`sort-${n}-icon`).textContent=s==="asc"?"↑":"↓",h.sort((d,l)=>{let a,e;n==="status"?(a=(d.shipmentStatus||"").trim(),e=(l.shipmentStatus||"").trim()):n==="productName"?(a=(d.productName||"").trim(),e=(l.productName||"").trim()):n==="ingredientName"&&(a=(d.ingredientName||"").trim(),e=(l.ingredientName||"").trim());const u=a.localeCompare(e,"ja",{sensitivity:"base"});return s==="asc"?u:-u}),V(h),m(`「${n==="status"?"出荷状況":n==="productName"?"品名":"成分名"}」を${s==="asc"?"昇順":"降順"}でソートしました。`,"success")}function ee(){const n=["drugName","ingredientName","makerName"],s=Y(b,300);n.forEach(o=>{const d=document.getElementById(o);d.addEventListener("compositionstart",()=>{P=!0}),d.addEventListener("compositionend",()=>{P=!1,s()}),d.addEventListener("input",()=>{P||s()})}),document.getElementById("statusNormal").addEventListener("change",b),document.getElementById("statusLimited").addEventListener("change",b),document.getElementById("statusStopped").addEventListener("change",b),document.getElementById("sort-productName-button").addEventListener("click",()=>j("productName")),document.getElementById("sort-ingredientName-button").addEventListener("click",()=>j("ingredientName")),document.getElementById("sort-status-button").addEventListener("click",()=>j("status"))}function Q(n){document.getElementById("drugName").value="",document.getElementById("makerName").value="";const s=document.getElementById("ingredientName");s&&(s.value=n,b(),window.scrollTo({top:0,behavior:"instant"}),m(`成分「${n}」で検索しました。`,"info"))}window.onload=async function(){document.body.classList.add("loaded"),document.getElementById("sort-status-icon").textContent="↕",document.getElementById("sort-productName-icon").textContent="↕",document.getElementById("sort-ingredientName-icon").textContent="↕",ee(),document.getElementById("share-btn").addEventListener("click",_),document.getElementById("reload-data").addEventListener("click",()=>{localforage.removeItem("excelCache").then(async()=>{m("キャッシュをクリアしました。データを再読み込みします。","info");const s=await G(O);s&&s.data&&(y=s.data,m(`データを再読み込みしました: ${y.length}件`,"success"))}).catch(s=>{console.error("Failed to clear cache",s),m("キャッシュのクリアに失敗しました。","error")})});const n=await G(O);n&&n.data?(y=n.data,V([]),z.classList.add("hidden"),Z()?b():m(`データ(${n.date}) ${y.length} 件を読み込みました。検索を開始できます。`,"success")):m("データの読み込みに失敗しました。リロードボタンで再試行してください。","error")};
