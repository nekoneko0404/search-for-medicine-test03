import"./modulepreload-polyfill-B5Qt9EMX.js";import{l as J,c as X}from"./data-BguHeUhv.js";import{d as Y,n as w,f as R}from"./utils-cz7vvGbo.js";import{u as z,s as N,c as Q,r as W}from"./ui-C1FH7vrA.js";import"./MainHeader-Cz0INnUv.js";/* empty css              */import{a as Z}from"./typing-animation-B3fvp7eE.js";let S=[],B=[],L={status:"asc",productName:"asc",ingredientName:"asc"};const e={searchInput:null,updatePeriod:null,searchBtn:null,recoveryBtn:null,clearBtn:null,shareBtn:null,resultTableBody:null,tableContainer:null,loadingIndicator:null,reloadDataBtn:null,statusCheckboxes:{normal:null,limited:null,stopped:null},trendCheckboxes:{up:null,down:null},sortButtons:{status:null,productName:null,ingredientName:null},sortIcons:{status:null,productName:null,ingredientName:null},mainHeader:null,mainFooter:null};function _(){e.searchInput=document.getElementById("searchInput"),e.updatePeriod=document.getElementById("updatePeriod"),e.searchBtn=document.getElementById("search-btn"),e.recoveryBtn=document.getElementById("recovery-btn"),e.clearBtn=document.getElementById("clear-btn"),e.shareBtn=document.getElementById("share-btn"),e.resultTableBody=document.getElementById("resultTableBody"),e.tableContainer=document.getElementById("tableContainer"),e.cardContainer=document.getElementById("cardContainer"),e.loadingIndicator=document.getElementById("loadingIndicator"),e.reloadDataBtn=document.getElementById("reload-data"),e.statusCheckboxes.normal=document.getElementById("statusNormal"),e.statusCheckboxes.limited=document.getElementById("statusLimited"),e.statusCheckboxes.stopped=document.getElementById("statusStop"),e.trendCheckboxes.up=document.getElementById("trendUp"),e.trendCheckboxes.down=document.getElementById("trendDown"),e.sortButtons.status=document.getElementById("sort-status-button"),e.sortButtons.productName=document.getElementById("sort-productName-button"),e.sortButtons.ingredientName=document.getElementById("sort-ingredientName-button"),e.sortIcons.status=document.getElementById("sort-status-icon"),e.sortIcons.productName=document.getElementById("sort-productName-icon"),e.sortIcons.ingredientName=document.getElementById("sort-ingredientName-icon"),e.mainHeader=document.getElementById("mainHeader"),e.mainFooter=document.getElementById("mainFooter")}async function ee(){_();try{const n=await J(z);if(n&&n.data){S=n.data,N(`データ(${n.date}) ${S.length} 件を読み込みました。`,"success");const s=new URLSearchParams(window.location.search),t=s.get("productName"),o=s.get("shippingStatus"),a=s.get("updateDate"),r=s.get("q"),p=s.get("period");s.has("q")||s.has("period")||s.has("normal")?(te(s),g()):t||o||a?(t&&(e.searchInput.value=t),a&&(e.updatePeriod.value=a),o&&(o==="all"?(e.statusCheckboxes.normal.checked=!0,e.statusCheckboxes.limited.checked=!0,e.statusCheckboxes.stopped.checked=!0):(e.statusCheckboxes.normal.checked=o==="normal",e.statusCheckboxes.limited.checked=o==="limited",e.statusCheckboxes.stopped.checked=o==="stopped")),g()):G()}}catch(n){console.error(n),N("データの読み込みに失敗しました。","error")}e.searchBtn.addEventListener("click",()=>{e.searchInput.value.trim()!==""&&(e.updatePeriod.value="all"),g()}),e.reloadDataBtn&&e.reloadDataBtn.addEventListener("click",async()=>{if(!e.reloadDataBtn.disabled){e.reloadDataBtn.disabled=!0,e.reloadDataBtn.classList.add("opacity-50","cursor-not-allowed"),N("最新データを取得しています...","info");try{const n=await X(z);n&&n.data&&(S=n.data,N(`データを更新しました: ${S.length}件`,"success"),g())}catch(n){console.error("Reload failed:",n),N(`データの更新に失敗しました: ${n.message||"不明なエラー"}`,"error")}finally{e.reloadDataBtn.disabled=!1,e.reloadDataBtn.classList.remove("opacity-50","cursor-not-allowed")}}}),e.clearBtn.addEventListener("click",G),e.shareBtn&&e.shareBtn.addEventListener("click",()=>ne()),e.recoveryBtn.addEventListener("click",()=>{e.searchInput.value="",e.updatePeriod.value="30days",e.trendCheckboxes.up&&(e.trendCheckboxes.up.checked=!0),e.trendCheckboxes.down&&(e.trendCheckboxes.down.checked=!1),e.statusCheckboxes.normal.checked=!0,e.statusCheckboxes.limited.checked=!0,e.statusCheckboxes.stopped.checked=!1,g()});let d=!1;e.searchInput.addEventListener("compositionstart",()=>d=!0),e.searchInput.addEventListener("compositionend",()=>{d=!1,h()});const h=Y(()=>{e.searchInput.value.trim()!==""&&(e.updatePeriod.value="all"),g()},300);e.searchInput.addEventListener("input",()=>{d||h()}),e.searchInput.addEventListener("keydown",n=>{n.key==="Enter"&&!d&&(n.preventDefault(),e.searchInput.value.trim()!==""&&(e.updatePeriod.value="all"),g())}),e.updatePeriod.addEventListener("change",g),Object.values(e.statusCheckboxes).forEach(n=>{n&&n.addEventListener("change",g)}),Object.values(e.trendCheckboxes).forEach(n=>{n&&n.addEventListener("change",g)}),e.sortButtons.productName&&e.sortButtons.productName.addEventListener("click",()=>H("productName")),e.sortButtons.ingredientName&&e.sortButtons.ingredientName.addEventListener("click",()=>H("ingredientName")),e.sortButtons.status&&e.sortButtons.status.addEventListener("click",()=>H("status"))}function G(){e.searchInput.value="",e.updatePeriod.value="7days",e.statusCheckboxes.normal.checked=!0,e.statusCheckboxes.limited.checked=!0,e.statusCheckboxes.stopped.checked=!0,e.trendCheckboxes.up&&(e.trendCheckboxes.up.checked=!1),e.trendCheckboxes.down&&(e.trendCheckboxes.down.checked=!1),g(!0)}function te(d){const h=d.get("q");h!==null&&e.searchInput&&(e.searchInput.value=h);const n=d.get("period");n&&e.updatePeriod&&(e.updatePeriod.value=n),e.statusCheckboxes.normal&&(e.statusCheckboxes.normal.checked=d.get("normal")==="1"),e.statusCheckboxes.limited&&(e.statusCheckboxes.limited.checked=d.get("limited")==="1"),e.statusCheckboxes.stopped&&(e.statusCheckboxes.stopped.checked=d.get("stopped")==="1"),e.trendCheckboxes.up&&(e.trendCheckboxes.up.checked=d.get("up")==="1"),e.trendCheckboxes.down&&(e.trendCheckboxes.down.checked=d.get("down")==="1")}async function ne(){const d=e.searchInput?.value?.trim()||"",h=e.updatePeriod?.value||"7days",n=new URLSearchParams;d&&n.set("q",d),h!=="7days"&&n.set("period",h),n.set("normal",e.statusCheckboxes.normal?.checked?"1":"0"),n.set("limited",e.statusCheckboxes.limited?.checked?"1":"0"),n.set("stopped",e.statusCheckboxes.stopped?.checked?"1":"0"),n.set("up",e.trendCheckboxes.up?.checked?"1":"0"),n.set("down",e.trendCheckboxes.down?.checked?"1":"0");const t=`${window.location.origin+window.location.pathname}?${n.toString()}`;try{await navigator.clipboard.writeText(t),N("検索条件のURLをクリップボードにコピーしました","success")}catch(o){console.error("Failed to copy to clipboard:",o),N("URLのコピーに失敗しました","error")}}function H(d){if(B.length===0){N("ソートするデータがありません。","info");return}const h=L[d]==="asc"?"desc":"asc";L[d]=h;for(const t in L)if(t!==d){L[t]="asc";const o=e.sortIcons[t];o&&(o.textContent="↕")}const n=e.sortIcons[d];n&&(n.textContent=h==="asc"?"↑":"↓"),B.sort((t,o)=>{let a,r;d==="status"?(a=(t.shipmentStatus||"").trim(),r=(o.shipmentStatus||"").trim()):d==="productName"?(a=(t.productName||"").trim(),r=(o.productName||"").trim()):d==="ingredientName"&&(a=(t.ingredientName||"").trim(),r=(o.ingredientName||"").trim());const p=a.localeCompare(r,"ja",{sensitivity:"base"});return h==="asc"?p:-p}),K(B);let s="";switch(d){case"status":s="出荷状況";break;case"productName":s="品名";break;case"ingredientName":s="成分名";break}N(`「${s}」を${h==="asc"?"昇順":"降順"}でソートしました。`,"success")}function g(d=!1){if(d?document.body.classList.remove("search-mode"):document.body.classList.add("search-mode"),S.length===0)return;const n=(r=>{if(!r)return{include:[],exclude:[]};const p=r.split(/[\s　]+/).filter(C=>C.length>0),i=[],f=[];return p.forEach(C=>{(C.startsWith("ー")||C.startsWith("-"))&&C.length>1?f.push(w(C.substring(1))):i.push(w(C))}),{include:i,exclude:f}})(e.searchInput.value),s=e.updatePeriod.value,t={normal:e.statusCheckboxes.normal?.checked||!1,limited:e.statusCheckboxes.limited?.checked||!1,stopped:e.statusCheckboxes.stopped?.checked||!1},o={up:e.trendCheckboxes.up?e.trendCheckboxes.up.checked:!1,down:e.trendCheckboxes.down?e.trendCheckboxes.down.checked:!1},a=new Date;a.setHours(0,0,0,0),B=S.filter(r=>{if(!((m,l)=>{if(l.include.length===0&&l.exclude.length===0)return!0;const E=m.normalizedProductName||"",b=m.normalizedManufacturer||"",k=m.normalizedIngredientName||"",D=l.include.every(x=>E.includes(x)||b.includes(x)||k.includes(x)),y=l.exclude.length===0||!l.exclude.some(x=>E.includes(x)||b.includes(x)||k.includes(x));return D&&y})(r,n))return!1;const i=(r.shipmentStatus||"").trim();let f=!1;if(t.normal&&(i.includes("通常")||i.includes("通"))&&(f=!0),t.limited&&(i.includes("限定")||i.includes("制限")||i.includes("限")||i.includes("制"))&&(f=!0),t.stopped&&(i.includes("停止")||i.includes("停"))&&(f=!0),!f)return!1;if(o.up||o.down){const m=r.shippingStatusTrend||"";let l=!1;if(o.up&&m==="⤴️"&&(l=!0),o.down&&m==="⤵️"&&(l=!0),!l)return!1}if(s!=="all"){if(!r.updateDateObj)return!1;const m=Math.abs(a-r.updateDateObj),l=Math.ceil(m/(1e3*60*60*24));if(s==="3days"&&l>3||s==="7days"&&l>7||s==="14days"&&l>14||s==="30days"&&l>30)return!1}return!0}),B.sort((r,p)=>{const i=r.updateDateObj?r.updateDateObj.getTime():0;return(p.updateDateObj?p.updateDateObj.getTime():0)-i}),L.status="asc",L.productName="asc",L.ingredientName="asc",e.sortIcons.status&&(e.sortIcons.status.textContent="↕"),e.sortIcons.productName&&(e.sortIcons.productName.textContent="↕"),e.sortIcons.ingredientName&&(e.sortIcons.ingredientName.textContent="↕"),document.body.classList.toggle("search-mode",B.length>0),setTimeout(()=>{K(B),B.length===0?N("条件に一致する更新情報はありません。","info"):N(`${B.length} 件の更新情報が見つかりました。`,"success")},100)}function K(d){const h=window.innerWidth<768;if(e.resultTableBody.innerHTML="",e.cardContainer.innerHTML="",d.length===0){e.tableContainer.classList.add("hidden"),e.cardContainer.classList.add("hidden"),e.tableContainer.classList.remove("fade-in");return}document.body.classList.add("search-mode");const n=d.slice(0,200),s={productName:5,ingredientName:2,shipmentStatus:11,reasonForLimitation:13,resolutionProspect:14,expectedDate:15,shipmentVolumeStatus:16,updateDate:24};h?(e.tableContainer.classList.add("hidden"),e.cardContainer.classList.remove("hidden"),e.cardContainer.classList.add("search-results-grid"),n.forEach((t,o)=>{const a=document.createElement("div");a.className="search-result-card bg-white p-4 rounded-lg shadow-sm border border-gray-200 transition-all duration-150 fade-in-up",a.style.animationDelay=o===0?"0s":`${o*.05}s`;const r=document.createElement("div");r.className="flex flex-col items-start mb-2";const p=document.createElement("div");p.className="flex gap-1 mb-1";const i=t.productCategory&&(t.productCategory.includes("後発品")||w(t.productCategory).includes("後発品")),f=t.isBasicDrug&&(t.isBasicDrug.includes("基礎的医薬品")||w(t.isBasicDrug).includes("基礎的医薬品"));if(i){const u=document.createElement("span");u.className="bg-green-100 text-green-800 px-1.5 py-0.5 rounded text-[10px] font-bold whitespace-nowrap border border-green-200",u.textContent="後発",p.appendChild(u)}if(f){const u=document.createElement("span");u.className="bg-purple-100 text-purple-800 px-1.5 py-0.5 rounded text-[10px] font-bold whitespace-nowrap border border-purple-200",u.textContent="基礎",p.appendChild(u)}p.hasChildNodes()&&r.appendChild(p);const C=document.createElement("div");if(C.className="flex items-center",t.yjCode){const u=Q(t,o);C.appendChild(u)}else{const u=document.createElement("span");u.textContent=t.productName||"",u.className=`${t.updatedCells&&t.updatedCells.includes(s.productName)?"text-red-600 font-bold":""}`,C.appendChild(u)}r.appendChild(C),a.appendChild(r);const m=document.createElement("div");m.className="text-sm text-gray-700 mb-2";const l=document.createElement("span");l.className="font-semibold text-gray-500 mr-2",l.textContent="成分名:",m.appendChild(l);const E=document.createElement("span");E.textContent=t.ingredientName||"",E.className=`${t.updatedCells&&t.updatedCells.includes(s.ingredientName)?"text-red-600 font-bold":""}`,m.appendChild(E),a.appendChild(m);const b=document.createElement("div");b.className="flex items-center gap-2 mb-2";const k=document.createElement("span");k.className="font-semibold text-gray-500 mr-2",k.textContent="出荷状況:",b.appendChild(k);const D=t.updatedCells&&t.updatedCells.includes(s.shipmentStatus);if(b.appendChild(W(t.shipmentStatus,D)),t.shippingStatusTrend){const u=document.createElement("span");u.className="text-base text-red-500 font-bold",u.textContent=t.shippingStatusTrend,b.appendChild(u)}a.appendChild(b);const y=document.createElement("div");y.className="text-sm text-gray-700 mb-2";const x=document.createElement("span");x.className="font-semibold text-gray-500 mr-2",x.textContent="制限理由:",y.appendChild(x);const I=document.createElement("span");I.textContent=t.reasonForLimitation||"-",I.className=`${t.updatedCells&&t.updatedCells.includes(s.reasonForLimitation)?"text-red-600 font-bold":""}`,y.appendChild(I),a.appendChild(y);const v=document.createElement("div");v.className="text-sm text-gray-700 mb-2";const c=document.createElement("span");c.className="font-semibold text-gray-500 mr-2",c.textContent="解消見込み:",v.appendChild(c);const F=document.createElement("span");F.textContent=t.resolutionProspect||"-",F.className=`${t.updatedCells&&t.updatedCells.includes(s.resolutionProspect)?"text-red-600 font-bold":""}`,v.appendChild(F),a.appendChild(v);const $=document.createElement("div");$.className="text-sm text-gray-700 mb-2";const M=document.createElement("span");M.className="font-semibold text-gray-500 mr-2",M.textContent="見込み時期:",$.appendChild(M);const P=document.createElement("span");if(t.expectedDateObj){const u=R(t.expectedDateObj);P.textContent=u?`${u.substring(2,4)}-${u.substring(4,6)}-${u.substring(6,8)}`:t.expectedDate||"-"}else P.textContent=t.expectedDate||"-";P.className=`${t.updatedCells&&t.updatedCells.includes(s.expectedDate)?"text-red-600 font-bold":""}`,$.appendChild(P),a.appendChild($);const T=document.createElement("div");T.className="text-sm text-gray-700 mb-2";const U=document.createElement("span");U.className="font-semibold text-gray-500 mr-2",U.textContent="出荷量:",T.appendChild(U);const A=document.createElement("span");A.textContent=t.shipmentVolumeStatus||"-",A.className=`${t.updatedCells&&t.updatedCells.includes(s.shipmentVolumeStatus)?"text-red-600 font-bold":""}`,T.appendChild(A),a.appendChild(T);const j=document.createElement("div");j.className="text-sm text-gray-700";const V=document.createElement("span");V.className="font-semibold text-gray-500 mr-2",V.textContent="更新日:",j.appendChild(V);const q=document.createElement("span"),O=t.updateDateObj?R(t.updateDateObj):"";q.textContent=O?`${O.substring(2,4)}-${O.substring(4,6)}-${O.substring(6,8)}`:"",q.className=`${t.updatedCells&&t.updatedCells.includes(s.updateDate)?"text-red-600 font-bold":""}`,j.appendChild(q),a.appendChild(j),e.cardContainer.appendChild(a)})):(e.tableContainer.classList.remove("hidden"),e.cardContainer.classList.add("hidden"),requestAnimationFrame(()=>{e.tableContainer.classList.add("fade-in")}),n.forEach((t,o)=>{const a=e.resultTableBody.insertRow(),r=o%2===1?"bg-gray-50":"bg-white";a.className=`${r} hover:bg-indigo-50 transition-colors group fade-in-up`,a.style.animationDelay=o===0?"0s":`${o*.05}s`;const p=a.insertCell(0);p.className="px-4 py-2 text-sm text-gray-900 font-medium align-top";const i=document.createElement("div");i.className="vertical-labels-container";const f=t.productCategory&&(t.productCategory.includes("後発品")||w(t.productCategory).includes("後発品")),C=t.isBasicDrug&&(t.isBasicDrug.includes("基礎的医薬品")||w(t.isBasicDrug).includes("基礎的医薬品"));if(f){const c=document.createElement("span");c.className="medicine-badge badge-generic",c.textContent="後",i.appendChild(c)}if(C){const c=document.createElement("span");c.className="medicine-badge badge-basic",c.textContent="基",i.appendChild(c)}const m=document.createElement("div");if(m.className="flex items-start",i.hasChildNodes()&&m.appendChild(i),t.yjCode)m.appendChild(Q(t,o));else{const c=document.createElement("span");c.textContent=t.productName||"",m.appendChild(c)}p.appendChild(m),t.updatedCells&&t.updatedCells.includes(s.productName)&&p.classList.add("text-red-600","font-bold");const l=a.insertCell(1);if(l.className="px-4 py-2 text-sm align-top",t.updatedCells&&t.updatedCells.includes(s.ingredientName)&&l.classList.add("text-red-600","font-bold"),t.ingredientName){const c=document.createElement("span");c.className="text-indigo-600 font-semibold hover:underline cursor-pointer",c.textContent=t.ingredientName,c.addEventListener("click",()=>{e.searchInput.value=t.ingredientName,e.updatePeriod.value="all",e.statusCheckboxes.normal.checked=!0,e.statusCheckboxes.limited.checked=!0,e.statusCheckboxes.stopped.checked=!0,e.trendCheckboxes.up&&(e.trendCheckboxes.up.checked=!1),e.trendCheckboxes.down&&(e.trendCheckboxes.down.checked=!1),g(),window.scrollTo({top:0,behavior:"smooth"})}),l.appendChild(c)}else l.className+=" text-gray-600",l.textContent="";const E=a.insertCell(2);E.className="px-4 py-2 align-top text-left";const b=document.createElement("div");if(b.className="flex items-center gap-1",b.appendChild(W(t.shipmentStatus,t.updatedCells&&t.updatedCells.includes(s.shipmentStatus))),t.shippingStatusTrend){const c=document.createElement("span");c.className="text-base text-red-500 font-bold",c.textContent=t.shippingStatusTrend,b.appendChild(c)}E.appendChild(b);const k=a.insertCell(3);k.className="px-4 py-2 text-xs text-gray-900 align-top truncate-lines",t.updatedCells&&t.updatedCells.includes(s.reasonForLimitation)&&k.classList.add("text-red-600","font-bold"),k.textContent=t.reasonForLimitation||"-";const D=a.insertCell(4);D.className="px-4 py-2 text-xs text-gray-900 align-top truncate-lines",t.updatedCells&&t.updatedCells.includes(s.resolutionProspect)&&D.classList.add("text-red-600","font-bold"),D.textContent=t.resolutionProspect||"-";const y=a.insertCell(5);if(y.className="px-4 py-2 text-xs text-gray-900 align-top",t.updatedCells&&t.updatedCells.includes(s.expectedDate)&&y.classList.add("text-red-600","font-bold"),t.expectedDateObj){const c=R(t.expectedDateObj);y.textContent=c?`${c.substring(2,4)}-${c.substring(4,6)}-${c.substring(6,8)}`:t.expectedDate||"-"}else y.textContent=t.expectedDate||"-";const x=a.insertCell(6);x.className="px-4 py-2 text-xs text-gray-900 align-top",t.updatedCells&&t.updatedCells.includes(s.shipmentVolumeStatus)&&x.classList.add("text-red-600","font-bold"),x.textContent=t.shipmentVolumeStatus||"-";const I=a.insertCell(7);I.className="px-4 py-2 text-xs text-gray-900 whitespace-nowrap align-top",t.updatedCells&&t.updatedCells.includes(s.updateDate)&&I.classList.add("text-red-600","font-bold");const v=t.updateDateObj?R(t.updateDateObj):"";I.textContent=v?`${v.substring(2,4)}-${v.substring(4,6)}-${v.substring(6,8)}`:""}))}document.addEventListener("DOMContentLoaded",ee);document.addEventListener("DOMContentLoaded",()=>{const d=document.getElementById("searchInput");Z(d,"医薬品名・成分名・メーカー名で検索 (スペースでAND検索)",80)});
