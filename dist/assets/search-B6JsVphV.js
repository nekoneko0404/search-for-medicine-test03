import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{s as u,u as z,c as H,r as G}from"./MainHeader-D0waqA3x.js";import{n as M,d as Q}from"./utils-cz7vvGbo.js";import{l as q}from"./data-DocyalmU.js";let y=[],g=[],b={status:"asc",productName:"asc",ingredientName:"asc"};document.getElementById("messageBox");document.getElementById("tableContainer");document.getElementById("cardContainer");const W=document.getElementById("resultsWrapper");let K=!1;function A(n){const s=n.split(/\s+|　+/).filter(a=>a!==""),o=[],c=[];return s.forEach(a=>{(a.startsWith("ー")||a.startsWith("-"))&&a.length>1?c.push(M(a.substring(1))):o.push(M(a))}),{include:o,exclude:c}}function I(){if(document.getElementById("usage-guide").classList.add("hidden"),y.length===0)return;const n=A(document.getElementById("drugName").value),s=A(document.getElementById("ingredientName").value),o=A(document.getElementById("makerName").value),c=document.getElementById("statusNormal").checked&&document.getElementById("statusLimited").checked&&document.getElementById("statusStopped").checked;if(n.include.length===0&&n.exclude.length===0&&s.include.length===0&&s.exclude.length===0&&o.include.length===0&&o.exclude.length===0&&c){U([]),W.classList.add("hidden"),document.body.classList.remove("search-mode"),document.getElementById("usage-guide").classList.remove("hidden");return}else W.classList.remove("hidden");const t=[];document.getElementById("statusNormal").checked&&t.push("通常出荷"),document.getElementById("statusLimited").checked&&t.push("限定出荷"),document.getElementById("statusStopped").checked&&t.push("供給停止"),g=y.filter(m=>{if(!m)return!1;const p=m.normalizedProductName||"",f=m.normalizedIngredientName||"",v=m.normalizedMakerName||"",w=n.include.every(l=>p.includes(l))&&(n.exclude.length===0||!n.exclude.some(l=>p.includes(l))),C=s.include.every(l=>f.includes(l))&&(s.exclude.length===0||!s.exclude.some(l=>f.includes(l))),x=o.include.every(l=>p.includes(l)||v.includes(l)||f.includes(l))&&(o.exclude.length===0||!o.exclude.some(l=>p.includes(l)||v.includes(l)||f.includes(l)));if(t.length===0)return!1;const r=(m.shipmentStatus||"").trim();let h=!1;return t.includes("通常出荷")&&(r.includes("通常出荷")||r.includes("通"))&&(h=!0),t.includes("限定出荷")&&(r.includes("限定出荷")||r.includes("出荷制限")||r.includes("限")||r.includes("制"))&&(h=!0),t.includes("供給停止")&&(r.includes("供給停止")||r.includes("停止")||r.includes("停"))&&(h=!0),w&&C&&x&&h}),U(g),document.body.classList.toggle("search-mode",g.length>0),g.length===0?(u("検索結果が見つかりませんでした。","info"),hideMessage(2e3)):g.length>500?(u(`${g.length} 件のデータが見つかりました。
表示は上位 500 件に制限されています。`,"success"),hideMessage(2e3)):(u(`${g.length} 件のデータが見つかりました。`,"success"),hideMessage(2e3)),b.status="asc",b.productName="asc";const d=document.getElementById("sort-status-icon");d&&(d.textContent="↕");const i=document.getElementById("sort-productName-icon");i&&(i.textContent="↕");const E=document.getElementById("sort-ingredientName-icon");E&&(E.textContent="↕")}function U(n){const s=document.getElementById("searchResultTableBody"),o=document.getElementById("cardContainer");if(document.getElementById("tableContainer"),s.innerHTML="",o.innerHTML="",n.length===0){const d=s.insertRow().insertCell(0);d.colSpan=5,d.textContent="該当データがありません",d.className="px-4 py-3 text-sm text-gray-500 text-center italic";const i=document.createElement("div");i.className="bg-white p-8 text-center text-gray-500 italic rounded-lg shadow",i.textContent="該当データがありません",o.appendChild(i);return}const c=n.slice(0,500),a={productName:5,ingredientName:2,shipmentStatus:11,reasonForLimitation:13,shipmentVolumeStatus:16};c.forEach((t,d)=>{const i=s.insertRow(),E=d%2===1?"bg-indigo-50":"bg-white";i.className=`${E} transition-colors duration-150 hover:bg-indigo-200`;const m=i.insertCell(0);m.setAttribute("data-label","品名"),m.classList.add("px-4","py-2","text-sm","text-gray-900","relative","align-top"),t.updatedCells&&t.updatedCells.includes(a.productName)&&m.classList.add("text-red-600","font-bold");const p=document.createElement("div");p.className="vertical-labels-container";const f=t.productCategory&&M(t.productCategory).includes("後発品"),v=t.isBasicDrug&&M(t.isBasicDrug).includes("基礎的医薬品");if(f){const e=document.createElement("span");e.className="medicine-badge badge-generic",e.textContent="後",p.appendChild(e)}if(v){const e=document.createElement("span");e.className="medicine-badge badge-basic",e.textContent="基",p.appendChild(e)}const w=t.productName||"",C=document.createElement("div");if(C.className="flex items-start",p.hasChildNodes()&&C.appendChild(p),t.yjCode){const e=H(t,d);C.appendChild(e)}else{const e=document.createElement("span");e.className="font-semibold truncate-lines",e.textContent=w,C.appendChild(e)}m.appendChild(C);const x=i.insertCell(1);x.setAttribute("data-label","成分名"),x.classList.add("px-4","py-2","text-sm","text-gray-900","truncate-lines","align-top"),t.updatedCells&&t.updatedCells.includes(a.ingredientName)&&x.classList.add("text-red-600","font-bold");const r=t.ingredientName||"";if(r){const e=document.createElement("a");e.href="#",e.className="text-indigo-600 font-semibold hover:underline",e.textContent=r,e.addEventListener("click",T=>{T.preventDefault(),J(r)}),x.appendChild(e)}else x.textContent=r;const h=i.insertCell(2);h.setAttribute("data-label","出荷状況"),h.classList.add("tight-cell","py-2","text-gray-900","text-left","align-top");const l=document.createElement("div");l.className="flex items-center";const V=t.updatedCells&&t.updatedCells.includes(a.shipmentStatus);V&&h.classList.add("text-red-600","font-bold");const j=(t.shipmentStatus||"").trim();if(l.appendChild(G(j,V)),t.shippingStatusTrend){const e=document.createElement("span");e.className="ml-1 text-red-500",e.textContent=t.shippingStatusTrend,l.appendChild(e)}h.appendChild(l);const S=i.insertCell(3);S.textContent=t.reasonForLimitation||"",S.setAttribute("data-label","制限理由"),S.classList.add("px-4","py-2","text-xs","text-gray-900","truncate-lines","align-top"),t.updatedCells&&t.updatedCells.includes(a.reasonForLimitation)&&S.classList.add("text-red-600","font-bold");const k=i.insertCell(4);k.textContent=t.shipmentVolumeStatus||"",k.setAttribute("data-label","出荷量状況"),k.classList.add("px-4","py-2","text-xs","text-gray-900","align-top"),t.updatedCells&&t.updatedCells.includes(a.shipmentVolumeStatus)&&k.classList.add("text-red-600","font-bold");const N=document.createElement("div");N.className="bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex flex-col gap-3";const D=document.createElement("div");D.className="flex items-start gap-2";const B=document.createElement("div");if(B.className="flex flex-col gap-1 mt-1",f){const e=document.createElement("span");e.className="bg-green-200 text-green-800 px-1 rounded-sm text-[10px] font-bold whitespace-nowrap text-center",e.textContent="後",B.appendChild(e)}if(v){const e=document.createElement("span");e.className="bg-purple-200 text-purple-800 px-1 rounded-sm text-[10px] font-bold whitespace-nowrap text-center",e.textContent="基",B.appendChild(e)}B.hasChildNodes()&&D.appendChild(B);const $=document.createElement("div");if($.className="flex-grow min-w-0",t.yjCode){const e=H(t,d+1e4);$.appendChild(e)}else{const e=document.createElement("span");e.className="font-bold text-gray-900 break-words",t.updatedCells&&t.updatedCells.includes(a.productName)&&e.classList.add("text-red-600"),e.textContent=w,$.appendChild(e)}if(D.appendChild($),N.appendChild(D),r){const e=document.createElement("div");e.className="text-xs text-gray-600";const T=document.createElement("span");T.textContent="成分: ",e.appendChild(T);const L=document.createElement("a");L.href="#",L.className="text-indigo-600 hover:underline",L.textContent=r,L.addEventListener("click",O=>{O.preventDefault(),J(r)}),e.appendChild(L),N.appendChild(e)}const F=document.createElement("div");F.className="flex items-center justify-between";const R=document.createElement("div");if(R.className="flex items-center",R.appendChild(G(j,V)),t.shippingStatusTrend){const e=document.createElement("span");e.className="ml-1 text-red-500",e.textContent=t.shippingStatusTrend,R.appendChild(e)}if(F.appendChild(R),t.shipmentVolumeStatus){const e=document.createElement("div");e.className="text-xs text-gray-500",e.textContent=t.shipmentVolumeStatus,t.updatedCells&&t.updatedCells.includes(a.shipmentVolumeStatus)&&e.classList.add("text-red-600","font-bold"),F.appendChild(e)}if(N.appendChild(F),t.reasonForLimitation){const e=document.createElement("div");e.className="text-xs text-gray-700 bg-gray-50 p-2 rounded",t.updatedCells&&t.updatedCells.includes(a.reasonForLimitation)&&e.classList.add("text-red-600","font-bold"),e.textContent=t.reasonForLimitation,N.appendChild(e)}o.appendChild(N)})}function X(){const n=new URLSearchParams(window.location.search),s=n.get("drug"),o=n.get("ingredient"),c=n.get("maker");if(!s&&!o&&!c&&!n.has("normal"))return!1;s&&(document.getElementById("drugName").value=s),o&&(document.getElementById("ingredientName").value=o),c&&(document.getElementById("makerName").value=c);const a=n.get("normal"),t=n.get("limited"),d=n.get("stopped");return a!==null&&(document.getElementById("statusNormal").checked=a==="1"),t!==null&&(document.getElementById("statusLimited").checked=t==="1"),d!==null&&(document.getElementById("statusStopped").checked=d==="1"),!0}async function Y(){const n=document.getElementById("drugName").value.trim(),s=document.getElementById("ingredientName").value.trim(),o=document.getElementById("makerName").value.trim(),c=document.getElementById("statusNormal").checked,a=document.getElementById("statusLimited").checked,t=document.getElementById("statusStopped").checked,d=new URLSearchParams;n&&d.set("drug",n),s&&d.set("ingredient",s),o&&d.set("maker",o),d.set("normal",c?"1":"0"),d.set("limited",a?"1":"0"),d.set("stopped",t?"1":"0");const E=`${window.location.origin+window.location.pathname}?${d.toString()}`;try{await navigator.clipboard.writeText(E),u("検索条件のURLをクリップボードにコピーしました","success")}catch(m){console.error("Failed to copy to clipboard:",m),u("URLのコピーに失敗しました","error")}}function P(n){if(g.length===0){u("ソートするデータがありません。","info");return}const s=b[n]==="asc"?"desc":"asc";b[n]=s;for(const c in b)if(c!==n){b[c]="asc";const a=document.getElementById(`sort-${c}-icon`);a&&(a.textContent="↕")}document.getElementById(`sort-${n}-icon`).textContent=s==="asc"?"↑":"↓",g.sort((c,a)=>{let t,d;n==="status"?(t=(c.shipmentStatus||"").trim(),d=(a.shipmentStatus||"").trim()):n==="productName"?(t=(c.productName||"").trim(),d=(a.productName||"").trim()):n==="ingredientName"&&(t=(c.ingredientName||"").trim(),d=(a.ingredientName||"").trim());const i=t.localeCompare(d,"ja",{sensitivity:"base"});return s==="asc"?i:-i}),U(g),u(`「${n==="status"?"出荷状況":n==="productName"?"品名":"成分名"}」を${s==="asc"?"昇順":"降順"}でソートしました。`,"success")}function Z(){const n=["drugName","ingredientName","makerName"],s=Q(I,300);n.forEach(o=>{const c=document.getElementById(o);c.addEventListener("compositionstart",()=>{K=!0}),c.addEventListener("compositionend",()=>{K=!1,s()}),c.addEventListener("input",()=>{K||s()})}),document.getElementById("statusNormal").addEventListener("change",I),document.getElementById("statusLimited").addEventListener("change",I),document.getElementById("statusStopped").addEventListener("change",I),document.getElementById("sort-productName-button").addEventListener("click",()=>P("productName")),document.getElementById("sort-ingredientName-button").addEventListener("click",()=>P("ingredientName")),document.getElementById("sort-status-button").addEventListener("click",()=>P("status"))}function J(n){document.getElementById("drugName").value="",document.getElementById("makerName").value="";const s=document.getElementById("ingredientName");s&&(s.value=n,I(),window.scrollTo({top:0,behavior:"instant"}),u(`成分「${n}」で検索しました。`,"info"))}window.onload=async function(){document.getElementById("sort-status-icon").textContent="↕",document.getElementById("sort-productName-icon").textContent="↕",document.getElementById("sort-ingredientName-icon").textContent="↕",Z(),document.getElementById("share-btn").addEventListener("click",Y),document.getElementById("reload-data").addEventListener("click",()=>{localforage.removeItem("excelCache").then(async()=>{u("キャッシュをクリアしました。データを再読み込みします。","info");const s=await q(z);s&&s.data&&(y=s.data,u(`データを再読み込みしました: ${y.length}件`,"success"))}).catch(s=>{console.error("Failed to clear cache",s),u("キャッシュのクリアに失敗しました。","error")})});const n=await q(z);n&&n.data?(y=n.data,U([]),W.classList.add("hidden"),X()?I():u(`データ(${n.date}) ${y.length} 件を読み込みました。検索を開始できます。`,"success")):u("データの読み込みに失敗しました。リロードボタンで再試行してください。","error")};
