import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import"./MainHeader-Cz0INnUv.js";/* empty css              */import{l as we,c as Ie}from"./data-BguHeUhv.js";import{n as f,f as le}from"./utils-cz7vvGbo.js";import{u as G,s as N,c as ue,r as me}from"./ui-C1FH7vrA.js";document.addEventListener("DOMContentLoaded",()=>{const L=document.getElementById("drugName"),B=document.getElementById("ingredientName"),$=document.getElementById("catA"),S=document.getElementById("catB"),D=document.getElementById("catC"),j=document.getElementById("routeInternal"),T=document.getElementById("routeInjectable"),M=document.getElementById("routeExternal"),_=document.getElementById("statusNormal"),z=document.getElementById("statusLimited"),H=document.getElementById("statusStopped"),F=document.getElementById("summaryTableBody"),U=document.getElementById("summaryCardContainer"),Y=document.getElementById("summaryResults"),Q=document.getElementById("searchResultTableBody"),q=document.getElementById("cardContainer"),X=document.getElementById("summaryContainer"),Z=document.getElementById("detailContainer"),ee=document.getElementById("backButtonContainer"),ge=document.getElementById("backBtn"),R=document.getElementById("categoryFilterContainer"),P=document.getElementById("statusFilterContainer"),A=document.getElementById("routeFilterContainer"),k=document.getElementById("reload-data"),te=document.getElementById("share-btn");let x=[],w=new Map,ne=[],O=[],V="summary",K=null,m={key:"category",direction:"asc"};function se(t){if(!t)return null;const e=String(t);if(e.length<5)return null;const a=parseInt(e.charAt(4));return isNaN(a)?null:a>=0&&a<=3?"内":a>=4&&a<=6?"注":a>=7&&a<=9?"外":null}pe();async function pe(){fe();try{G("初期化中...",10),ne=await(await fetch("data/category_data.json")).json(),w=new Map,ne.forEach(a=>{const n=`${f(a.ingredient_name)}|${a.route}`;w.set(n,a)}),G("カテゴリデータ読み込み完了",30);const e=await we(G);if(e&&e.data){x=e.data.map(n=>{const c=se(n.yjCode),o=c?w.get(n.normalizedIngredientName+"|"+c):null;return{...n,category:o?o.category:"-",route:c||(o?o.route:"-"),drugClassCode:o?o.drug_class_code:"-",drugClassName:o?o.drug_class_name:"-"}});const a=new Set(x.map(n=>`${n.normalizedIngredientName}|${n.route}`));w.forEach((n,c)=>{a.has(c)||(x.push({productName:"-",normalizedProductName:"-",ingredientName:n.ingredient_name,normalizedIngredientName:f(n.ingredient_name),manufacturer:"-",normalizedManufacturer:"-",shipmentStatus:"データなし",reasonForLimitation:"-",resolutionProspect:"-",expectedDate:"-",yjCode:null,productCategory:n.category,isBasicDrug:"-",category:n.category,route:n.route,drugClassCode:n.drug_class_code,drugClassName:n.drug_class_name,updateDateObj:null}),a.add(c))});const r=document.getElementById("loadingIndicator");r&&r.classList.add("hidden"),Y&&Y.classList.remove("hidden"),N(`データ(${e.date}) ${x.length} 件を読み込みました。`,"success"),v()}}catch(t){console.error("Error loading data:",t);const e=document.getElementById("loadingIndicator");e&&e.classList.add("hidden"),F.innerHTML='<tr><td colspan="8" class="px-4 py-4 text-center text-red-500">データの読み込みに失敗しました</td></tr>',N("データの読み込みに失敗しました。","error")}}k&&k.addEventListener("click",async()=>{if(!k.disabled){k.disabled=!0,k.classList.add("opacity-50","cursor-not-allowed"),N("最新データを取得しています...","info");try{const t=await Ie(G);if(t&&t.data){x=t.data.map(a=>{const r=se(a.yjCode),n=r?w.get(a.normalizedIngredientName+"|"+r):null;return{...a,category:n?n.category:"-",route:r||(n?n.route:"-"),drugClassCode:n?n.drug_class_code:"-",drugClassName:n?n.drug_class_name:"-"}});const e=new Set(x.map(a=>`${a.normalizedIngredientName}|${a.route}`));w.forEach((a,r)=>{e.has(r)||(x.push({productName:"-",normalizedProductName:"-",ingredientName:a.ingredient_name,normalizedIngredientName:f(a.ingredient_name),manufacturer:"-",normalizedManufacturer:"-",shipmentStatus:"データなし",reasonForLimitation:"-",resolutionProspect:"-",expectedDate:"-",yjCode:null,productCategory:a.category,isBasicDrug:"-",category:a.category,route:a.route,drugClassCode:a.drug_class_code,drugClassName:a.drug_class_name,updateDateObj:null}),e.add(r))}),N(`データを更新しました: ${x.length}件`,"success"),v()}}catch(t){console.error("Reload failed:",t),N(`データの更新に失敗しました: ${t.message||"不明なエラー"}`,"error")}finally{k.disabled=!1,k.classList.remove("opacity-50","cursor-not-allowed")}}}),te&&te.addEventListener("click",he);function he(){const t=ye();navigator.clipboard.writeText(t).then(()=>{N("検索条件をクリップボードにコピーしました","success")}).catch(e=>{console.error("Failed to copy: ",e),N("コピーに失敗しました","error")})}function ye(){const t=new URLSearchParams;L.value&&t.set("drug",L.value),B.value&&t.set("ing",B.value);const e=[];$.checked&&e.push("A"),S.checked&&e.push("B"),D.checked&&e.push("C"),e.length<3&&t.set("cat",e.join(","));const a=[];j.checked&&a.push("internal"),T.checked&&a.push("injectable"),M.checked&&a.push("external"),a.length<3&&t.set("route",a.join(","));const r=[];_.checked&&r.push("normal"),z.checked&&r.push("limited"),H.checked&&r.push("stopped"),r.length<3&&t.set("status",r.join(",")),(m.key!=="category"||m.direction!=="asc")&&(t.set("sort",m.key),t.set("dir",m.direction));const n=window.location.origin+window.location.pathname;return t.toString()?`${n}?${t.toString()}`:n}function fe(){const t=new URLSearchParams(window.location.search);if(t.has("drug")&&(L.value=t.get("drug")),t.has("ing")&&(B.value=t.get("ing")),t.has("cat")){const e=t.get("cat").split(",");$.checked=e.includes("A"),S.checked=e.includes("B"),D.checked=e.includes("C")}if(t.has("route")){const e=t.get("route").split(",");j.checked=e.includes("internal"),T.checked=e.includes("injectable"),M.checked=e.includes("external")}if(t.has("status")){const e=t.get("status").split(",");_.checked=e.includes("normal"),z.checked=e.includes("limited"),H.checked=e.includes("stopped")}t.has("sort")&&(m.key=t.get("sort"),m.direction=t.get("dir")||"asc",re())}const ae=document.querySelectorAll("#summaryTable th[data-sort]");ae.forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-sort");m.key===e?m.direction=m.direction==="asc"?"desc":"asc":(m.key=e,m.direction="asc"),re(),v()})});function re(){ae.forEach(t=>{const e=t.querySelector(".sort-icon");t.getAttribute("data-sort")===m.key?(e.classList.remove("text-gray-400","group-hover:text-gray-600"),e.classList.add("text-indigo-600"),e.innerHTML=m.direction==="asc"?'<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>':'<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>'):(e.classList.add("text-gray-400","group-hover:text-gray-600"),e.classList.remove("text-indigo-600"),e.innerHTML='<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path></svg>')})}function xe(t,e){let a;return function(...r){clearTimeout(a),a=setTimeout(()=>t.apply(this,r),e)}}const oe=xe(v,300);let W=!1;[L,B].forEach(t=>{t.addEventListener("compositionstart",()=>{W=!0}),t.addEventListener("compositionend",()=>{W=!1,oe()}),t.addEventListener("input",()=>{W||oe()}),t.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),v(),t.blur())})}),[$,S,D,j,T,M,_,z,H].forEach(t=>{t&&t.addEventListener("change",v)}),ge.addEventListener("click",()=>{V="summary",K=null,Ce(),v()});function v(){const t=L.value.trim(),e=B.value.trim();!t&&!e&&$.checked&&S.checked&&D.checked&&j.checked&&T.checked&&M.checked&&_.checked&&z.checked&&H.checked;const a=l=>{if(!l)return{include:[],exclude:[]};const i=l.split(/[\s　]+/).filter(g=>g.length>0),u=[],s=[];return i.forEach(g=>{g.startsWith("ー")&&g.length>1?s.push(f(g.substring(1))):u.push(f(g))}),{include:u,exclude:s}},r=a(t),n=a(e),c=[];$.checked&&c.push("A"),S.checked&&c.push("B"),D.checked&&c.push("C");const o=[];j.checked&&o.push("内"),T.checked&&o.push("注"),M.checked&&o.push("外");const d=[];_.checked&&d.push("通常出荷"),z.checked&&d.push("限定出荷"),H.checked&&d.push("供給停止"),O=x.filter(l=>{const i=(E,b)=>{const ie=E||"",Ee=b.include.length===0||b.include.every(J=>ie.includes(J)),Ne=b.exclude.length===0||!b.exclude.some(J=>ie.includes(J));return Ee&&Ne},u=i(l.normalizedProductName,r),s=i(l.normalizedIngredientName,n),g=c.includes(l.category),I=o.includes(l.route),p=(l.shipmentStatus||"").trim();let y=!1;return d.includes("通常出荷")&&(p.includes("通常")||p.includes("通"))&&(y=!0),d.includes("限定出荷")&&(p.includes("限定")||p.includes("制限")||p.includes("限")||p.includes("制"))&&(y=!0),d.includes("供給停止")&&(p.includes("停止")||p.includes("停"))&&(y=!0),p==="データなし"&&(y=!0),u&&s&&g&&I&&y}),V==="summary"?be(O):de(O.filter(l=>l.normalizedIngredientName===f(K)));const h=O.length>0,C=V==="detail";document.body.classList.toggle("search-mode",h||C)}function be(t){if(F.innerHTML="",U.innerHTML="",t.length===0){F.innerHTML='<tr><td colspan="8" class="px-4 py-4 text-center text-gray-500">該当するデータがありません</td></tr>',U.innerHTML='<div class="col-span-full text-center py-8 text-gray-500">該当するデータがありません</div>';return}const e={};t.forEach(r=>{const n=r.ingredientName||"不明",c=r.route||"-",o=`${n}|${c}`;e[o]||(e[o]={ingredientName:n,route:c,category:r.category,drugClassCode:r.drugClassCode,drugClassName:r.drugClassName,counts:{normal:0,limited:0,stopped:0}});const d=(r.shipmentStatus||"").trim();d.includes("通常")||d.includes("通")?e[o].counts.normal++:d.includes("限定")||d.includes("制限")||d.includes("限")||d.includes("制")?e[o].counts.limited++:(d.includes("停止")||d.includes("停"))&&e[o].counts.stopped++}),Object.keys(e).sort((r,n)=>{const c=e[r],o=e[n],d={A:1,B:2,C:3},h={内:1,注:2,外:3},C=(s,g,I,p="asc")=>{const y=p==="asc"?1:-1;if(I==="category"){const E=d[s]||99,b=d[g]||99;if(E!==b)return(E-b)*y}else if(I==="route"){const E=h[s]||99,b=h[g]||99;if(E!==b)return(E-b)*y}return typeof s=="string"&&typeof g=="string"?s.localeCompare(g,"ja")*y:s<g?-1*y:s>g?1*y:0},l=[{key:"category",getVal:s=>s.category},{key:"route",getVal:s=>s.route},{key:"drugClassCode",getVal:s=>s.drugClassCode},{key:"drugClassName",getVal:s=>s.drugClassName},{key:"ingredientName",getVal:s=>s.ingredientName},{key:"statusNormal",getVal:s=>s.counts.normal},{key:"statusLimited",getVal:s=>s.counts.limited},{key:"statusStopped",getVal:s=>s.counts.stopped}];let i;switch(m.key){case"category":i=s=>s.category;break;case"route":i=s=>s.route;break;case"drugClassCode":i=s=>s.drugClassCode;break;case"drugClassName":i=s=>s.drugClassName;break;case"ingredientName":i=s=>s.ingredientName;break;case"statusNormal":i=s=>s.counts.normal;break;case"statusLimited":i=s=>s.counts.limited;break;case"statusStopped":i=s=>s.counts.stopped;break;default:i=s=>s.ingredientName}const u=C(i(c),i(o),m.key,m.direction);if(u!==0)return u;for(const s of l){if(s.key===m.key)continue;const g=s.getVal(c),I=s.getVal(o),p=C(g,I,s.key,"asc");if(p!==0)return p}return 0}).forEach(r=>{const n=e[r],c=document.createElement("tr");c.className="hover:bg-gray-50 transition-colors cursor-pointer",c.addEventListener("click",()=>ce(n.ingredientName,n.route)),c.innerHTML=`
                <td class="px-4 py-2 text-sm text-gray-900 font-bold text-center">${n.category}</td>
                <td class="px-4 py-2 text-sm text-gray-900 font-bold text-center">${n.route||"-"}</td>
                <td class="px-4 py-2 text-sm text-gray-700 text-center">${n.drugClassCode}</td>
                <td class="px-4 py-2 text-sm text-gray-700 max-w-[150px] truncate" title="${n.drugClassName}">${n.drugClassName}</td>
                <td class="px-4 py-2 text-sm text-indigo-600 font-medium hover:underline">${n.ingredientName}</td>
                 <td class="px-4 py-2 text-sm text-center">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        通常出荷 ${n.counts.normal}
                    </span>
                </td>
                <td class="px-4 py-2 text-sm text-center">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                        限定出荷 ${n.counts.limited}
                    </span>
                </td>
                <td class="px-4 py-2 text-sm text-center">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                        供給停止 ${n.counts.stopped}
                    </span>
                </td>
            `,F.appendChild(c);const o=document.createElement("div");o.className="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4 cursor-pointer hover:bg-gray-50 transition-colors",o.addEventListener("click",()=>ce(n.ingredientName,n.route)),o.innerHTML=`
                <div class="flex justify-between items-start mb-2">
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-bold bg-indigo-100 text-indigo-800">
                        カテゴリ ${n.category} / ${n.route}
                    </span>
                    <span class="text-xs text-gray-500 font-medium truncate max-w-[150px]">
                        ${n.drugClassCode}: ${n.drugClassName}
                    </span>
                </div>
                <h3 class="text-lg font-bold text-indigo-900 mb-3">${n.ingredientName}</h3>
                <div class="grid grid-cols-3 gap-2 mt-2">
                    <div class="text-center p-2 bg-blue-50 rounded-lg">
                        <span class="block text-xs text-blue-600 font-bold mb-1">通常</span>
                        <span class="text-lg font-bold text-blue-800">${n.counts.normal}</span>
                    </div>
                    <div class="text-center p-2 bg-yellow-50 rounded-lg">
                        <span class="block text-xs text-yellow-600 font-bold mb-1">限定</span>
                        <span class="text-lg font-bold text-yellow-800">${n.counts.limited}</span>
                    </div>
                    <div class="text-center p-2 bg-red-50 rounded-lg">
                        <span class="block text-xs text-red-600 font-bold mb-1">停止</span>
                        <span class="text-lg font-bold text-red-800">${n.counts.stopped}</span>
                    </div>
                </div>
            `,U.appendChild(o)})}function ce(t,e){V="detail",K=t;const a=f(t);X.classList.add("hidden"),Z.classList.remove("hidden"),ee.classList.remove("hidden"),R&&R.classList.add("hidden"),A&&A.classList.add("hidden"),P&&P.classList.remove("hidden");const r=document.getElementById("filterGrid");r&&r.classList.remove("md:grid-cols-3");const n=x.filter(c=>c.normalizedIngredientName===a&&c.route===e);de(n),window.scrollTo(0,0)}function Ce(){X.classList.remove("hidden"),Z.classList.add("hidden"),ee.classList.add("hidden"),R&&R.classList.remove("hidden"),A&&A.classList.remove("hidden"),P&&P.classList.add("hidden");const t=document.getElementById("filterGrid");t&&t.classList.add("md:grid-cols-3")}function de(t){ke(t),ve(t)}function ke(t){if(Q.innerHTML="",t.length===0){Q.innerHTML='<tr><td colspan="9" class="px-4 py-4 text-center text-gray-500">該当するデータがありません</td></tr>';return}t.slice(0,100).forEach((e,a)=>{const r=document.createElement("tr");r.className="hover:bg-gray-50 transition-colors";const n=e.updateDateObj?le(e.updateDateObj):"",c=n?`${n.substring(2,4)}-${n.substring(4,6)}-${n.substring(6,8)}`:"";r.innerHTML=`
                <td class="px-4 py-2 text-sm text-gray-900 font-bold text-center align-top">${e.category}</td>
                <td class="px-4 py-2 text-sm text-gray-900 font-bold text-center align-top">${e.route||"-"}</td>
                <td class="px-4 py-2 text-sm align-top"></td>
                <td class="px-4 py-2 text-sm text-gray-500 align-top">${e.ingredientName||""}</td>
                <td class="px-4 py-2 text-sm align-top"></td>
                <td class="px-4 py-2 text-sm text-gray-700 align-top">${e.reasonForLimitation||"-"}</td>
                <td class="px-4 py-2 text-sm text-gray-700 align-top">${e.resolutionProspect||"-"}</td>
                <td class="px-4 py-2 text-sm text-gray-700 align-top">${e.expectedDate||"-"}</td>
                <td class="px-4 py-2 text-xs text-gray-500 whitespace-nowrap align-top">${c}</td>
            `;const o=r.cells[2],d=document.createElement("div");d.className="vertical-labels-container";const h=e.productCategory&&f(e.productCategory).includes("後発品"),C=e.isBasicDrug&&f(e.isBasicDrug).includes("基礎的医薬品");if(h){const u=document.createElement("span");u.className="medicine-badge badge-generic",u.textContent="後",d.appendChild(u)}if(C){const u=document.createElement("span");u.className="medicine-badge badge-basic",u.textContent="基",d.appendChild(u)}const l=document.createElement("div");if(l.className="flex items-start",d.hasChildNodes()&&l.appendChild(d),e.yjCode)l.appendChild(ue(e,`table-${a}`));else{const u=document.createElement("span");u.className="text-indigo-600 font-medium",u.textContent=e.productName||"",l.appendChild(u)}o.appendChild(l);const i=me(e.shipmentStatus);r.cells[4].appendChild(i),Q.appendChild(r)})}function ve(t){if(q.innerHTML="",t.length===0){q.innerHTML='<div class="col-span-full text-center py-8 text-gray-500">該当するデータがありません</div>';return}t.slice(0,50).forEach((e,a)=>{const r=document.createElement("div");r.className="bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex flex-col gap-3";const n=e.updateDateObj?le(e.updateDateObj):"",c=n?`${n.substring(2,4)}-${n.substring(4,6)}-${n.substring(6,8)}`:"",o=me(e.shipmentStatus);r.innerHTML=`
                <div class="flex justify-between items-start">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                        カテゴリ ${e.category}
                    </span>
                    <span id="status-placeholder"></span>
                </div>
                <div class="product-name-container">
                    <!-- Dropdown will be inserted here -->
                </div>
                <p class="text-sm text-gray-500">${e.ingredientName||""}</p>
                <div class="grid grid-cols-2 gap-2 text-sm mt-2 border-t border-gray-100 pt-2">
                    <div>
                        <span class="block text-xs text-gray-500">制限理由</span>
                        <span class="text-gray-700 font-medium">${e.reasonForLimitation||"-"}</span>
                    </div>
                    <div>
                        <span class="block text-xs text-gray-500">解消見込み</span>
                        <span class="text-gray-700 font-medium">${e.resolutionProspect||"-"}</span>
                    </div>
                    <div>
                        <span class="block text-xs text-gray-500">見込み時期</span>
                        <span class="text-gray-700 font-medium">${e.expectedDate||"-"}</span>
                    </div>
                    <div>
                        <span class="block text-xs text-gray-500">更新日</span>
                        <span class="text-xs text-gray-700 whitespace-nowrap">${c}</span>
                    </div>
                </div>
            `;const d=r.querySelector(".product-name-container"),h=document.createElement("div");h.className="vertical-labels-container";const C=e.productCategory&&f(e.productCategory).includes("後発品"),l=e.isBasicDrug&&f(e.isBasicDrug).includes("基礎的医薬品");if(C){const s=document.createElement("span");s.className="medicine-badge badge-generic",s.textContent="後",h.appendChild(s)}if(l){const s=document.createElement("span");s.className="medicine-badge badge-basic",s.textContent="基",h.appendChild(s)}const i=document.createElement("div");if(i.className="flex items-start",h.hasChildNodes()&&i.appendChild(h),e.yjCode)i.appendChild(ue(e,`card-${a}`));else{const s=document.createElement("h3");s.className="text-lg font-bold text-indigo-900 mb-1",s.textContent=e.productName||"",i.appendChild(s)}d.appendChild(i),r.querySelector("#status-placeholder").replaceWith(o),q.appendChild(r)})}});
